<div id="admin-content">
    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <h1 class="admin-heading"><i class="fa fa-users"></i> All Users</h1>
            </div>
            <div class="col-md-2">
                <a class="add-new" href="/admin/add-user">add user</a>
            </div>
            <div class="col-md-12">
                
                <div id="usersTable"></div>
                
            </div>
        </div>
    </div>
</div>
<script src="/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="/js/tabulator.min.js"></script>

<script>
const tableData= <%- JSON.stringify(users) %>;

var table= new Tabulator('#usersTable',{
    data : tableData,
    layout : "fitColumns",
    pagination : true,
    paginationSize:10,
    paginationSizeSelector:[5,10,25,50,100],
    columns : [
         {title: "S.No.", formatter:"rownum",width:100,hozAlign:'center'},
        {title : "Full Name", field : "fullname", headerFilter : "input"},
        {title : "User Name", field : "username", headerFilter : "input"},
       
        {title : "Actions", formatter: function(cell, formatterParams, onRendered){
            return `<button class="btn btn-sm btn-danger delete-user" onclick="deleteUser('${cell.getData()._id}')">Delete</button>`
        
        }}

    ]
});

async function deleteUser(id){
    try{
        if(confirm('ARe you sure you want to delete this user?')){
           const response = await fetch(`/admin/delete-user/${id}`,{
                method:'delete'
            });
            if(response.ok){
                window.location.reload();
            }
        }
    } catch(error){
        console.log(error);
    }   
}
</script>
<%- contentFor('tabulatorCSS') %>
<link href="/css/tabulator.min.css" rel="stylesheet">
    <link href="/css/tabulator_bootstrap5.css" rel="stylesheet">